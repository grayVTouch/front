<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图片上传</title>

    <link rel="stylesheet" href="../Run/base.css">
    <link rel="stylesheet" href="../Run/font/iconfont.css">
    <link rel="stylesheet" href="css/Uploader.css" />

</head>
<body>

<div class="container" id="file" style="padding: 20px;">

    <!--
        上传图片组件，仅预览图片的 html 结构用户可以随意使用
        其他 preview 下面的仅用于开发，当使用的时候请删除
    -->
    <div class='uploader'>
        <div class="upload">
            <div class="handler">

                <div class="line input hide">
                    <input type="file" class="file-input">
                </div>

                <div class="line icon">
                    <div class="ico">
                        <div class="feedback run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shangchuan"></i></div>
                        <div class="clear run-action-feedback-round" title="清空"><i class="iconfont run-iconfont run-iconfont-qingkong"></i></div>
                    </div>
                    <div class="text">请选择要上传的文件或拖拽文件到此</div>
                </div>

            </div>

            <div class="msg">提示内容</div>
        </div>
        <div class="preview">

            <!-- 预览：文件 -->
            <div class="item video">
                <div class="inner">
                    <video src="" type="video/mp4" controls="controls"></video>
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                </div>
            </div>

            <!-- 预览：视频 -->
            <div class="item file">
                <div class="inner">
                    <div class="line ico"><i class="iconfont run-iconfont run-iconfont-wenjian"></i></div>
                    <div class="line text">文件名称.zip</div>
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                </div>
            </div>

            <!-- 预览：图片 -->
            <div class="item image">
                <div class="inner">
                    <img src="res/beauty.jpg" class="image">
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                </div>
            </div>

            <!-- 文件：正常状态 -->
            <div class="item file">
                <div class="inner">
                    <div class="line ico"><i class="iconfont run-iconfont run-iconfont-wenjian"></i></div>
                    <div class="line text">文件名称.zip</div>
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                    <div class="line delete run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shanchu"></i></div>
                </div>
                <div class="progress hide">
                    <div class="total">
                        <div class="current"></div>
                    </div>
                </div>

                <div class="status hide">
                    <i class="success iconfont run-iconfont run-iconfont-chenggong hide"></i>
                    <i class="error iconfont run-iconfont run-iconfont-shibai hide"></i>
                </div>
            </div>

            <!-- 图片：正常状态 -->
            <div class="item image">
                <div class="inner">
                    <img src="res/beauty.jpg" class="image">
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                    <div class="line delete run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shanchu"></i></div>
                </div>
                <div class="progress hide">
                    <div class="total">
                        <div class="current"></div>
                    </div>
                </div>
                <div class="status hide">
                    <i class="success iconfont run-iconfont run-iconfont-chenggong hide"></i>
                    <i class="error iconfont run-iconfont run-iconfont-shibai hide"></i>
                </div>
            </div>

            <!-- 文件：上传失败 -->
            <div class="item file">
                <div class="inner">
                    <div class="line ico"><i class="iconfont run-iconfont run-iconfont-wenjian"></i></div>
                    <div class="line text">文件名称.zip</div>
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                    <div class="line delete run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shanchu"></i></div>
                </div>
                <div class="progress hide">
                    <div class="total">
                        <div class="current"></div>
                    </div>
                </div>

                <div class="status">
                    <i class="success iconfont run-iconfont run-iconfont-chenggong hide"></i>
                    <i class="error iconfont run-iconfont run-iconfont-shibai"></i>
                </div>
            </div>

            <!-- 图片：上传成功 -->
            <div class="item image">
                <div class="inner">
                    <img src="res/beauty.jpg" class="image">
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                    <div class="line delete run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shanchu"></i></div>
                </div>
                <div class="progress hide">
                    <div class="total hide">
                        <div class="current"></div>
                    </div>
                </div>
                <div class="status">
                    <i class="success iconfont run-iconfont run-iconfont-chenggong"></i>
                    <i class="error iconfont run-iconfont run-iconfont-shibai hide"></i>
                </div>
            </div>

            <!-- 图片：进度条 -->
            <div class="item image">
                <div class="inner">
                    <img src="res/beauty.jpg" class="image">
                </div>
                <div class="mask">
                    <div class="line view run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-chakan"></i></div>
                    <div class="line delete run-action-feedback-round"><i class="iconfont run-iconfont run-iconfont-shanchu"></i></div>
                </div>
                <div class="progress">
                    <div class="total">
                        <div class="current" style="width: 30%"></div>
                    </div>
                </div>
                <div class="status hide">
                    <i class="success iconfont run-iconfont run-iconfont-chenggong hide"></i>
                    <i class="error iconfont run-iconfont run-iconfont-shibai hide"></i>
                </div>
            </div>

        </div>

    </div>

</div>

<br />
<br />
<br />

<button id="upload" class="run-button run-button-submit">上传</button>

<input type="file" id="u_file">
<button type="button">u 上传</button>

<script src="../SmallJs/SmallJs.js"></script>
<script src="../SparkMD5/spark-md5.min.js"></script>
<script src="js/Uploader.js"></script>
<script>
    'use strict';


    const uFile = document.querySelector('#u_file');
    uFile.onchange = (e) => {
        const tar = e.currentTarget;
        const files = tar.files;
        if (files.length <= 0) {
            return ;
        }
        const file = files[0];
        const size = 100 * 1024 * 1024;
        const chunk = file.slice(0 , Math.min(file.size , size));
        const formData = new FormData();
        formData.append('name' , file.name);
        formData.append('size' , file.size);
        formData.append('total' , 10);
        formData.append('index' , 1);
        formData.append('file' , chunk);

        fetch('http://api.xq.test/api/admin/upload_video' , {
            method: 'post' ,
            mode: 'cors' ,
            body: formData ,
        })
            .then((res) => {
                return res.text();
            })
            .then((res) => {
                console.log('response' , res);
            })
            .catch((err) => {
                console.log('error' , err);
            })
    };


    var file = G('#file');
    var uploader = new Uploader(file.get(0) , {
        // 上传地址
        api: 'http://api.xq.test/api/admin/upload_video' ,
        // 上传字段
        field: 'file' ,
        // 模式：append-追加 override-覆盖
        mode: 'override' ,
        // 单文件上传
        multiple: false ,
        direct: true ,
        // 单位：MB
        blockSize: 512 ,
        // 启用分块上传
        isEnabledBlock: true ,
        // 检查单个块上传是否成功
        isBlockUploadOk (res , code) {
            return code === 200;
        } ,
        // 单个文件上传完成调用
        uploaded: function(file , data , code){
            // this.status();
        } ,

        // 全部上传完成回调函数
        completed: function (total , uploaded , failed) {
            console.log('文件综述：' , total , uploaded , failed);

        } ,
        // 文件上传超时时间，默认：0-不限制
        // 单位： ms
        timeout: 0 ,
        clear: true ,
        mimeLimit: 'image' ,
    });

    var uploadBtn = G('#upload');
    uploadBtn.on('click' , function(){
        uploader.upload();
    } , true , false);
</script>

</body>
</html>
